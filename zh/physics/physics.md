# 3D 物理

## 3D 物理简介

![physics-system](img/physics-system.jpg)

物理系统是将游戏世界赋予现实世界的物理属性（重力、推力等），并抽象为刚体模型，使得游戏物体在力的作用下，仿真现实世界的运动及其之间的碰撞过程。即在牛顿经典力学模型基础之上，通过 API 计算游戏物体的运动、旋转和碰撞。

Cocos Creator 3.0 3D 物理支持以下几种物理引擎：

- **ammo.js**：默认物理引擎，[Bullet 物理引擎](https://pybullet.org/wordpress/) 的 asm.js/wasm 版本（ammo.js）。
- **builtin**：用于碰撞检测的轻量引擎。
- **cannon.js**：具有物理模拟的物理引擎。

并且为开发者提供了高效统一的组件化工作流程和便捷的使用方法，详情请参考设置 [设置物理引擎](physics-item.md)。

> **注意**：Cocos Creator 3.0 中实际有两个独立的物理系统：一个是 2D 物理系统，另一个是 3D 物理系统。它们作用对象不同，本章节重点介绍 3D 物理，2D 物理请参考 2D 物理章节。

## 物理世界和元素

物理世界中的每个元素都可以分为一个独立的 **刚体**，在 Cocos Creator 3.0 中可以通过为游戏对象添加 [Collider 碰撞组件](physics-collider.md) 或者 [RigidBody 刚体组件](physics-rigidbody.md) 让物理元素具备物理特性，物理系统将为这些元素进行物理计算，仿真还原真实世界中的物理行为。

> **注意**：此处的“刚体”不是指刚体组件，而是物理刚体（刚体是指在运动中和受力作用后，形状和大小不变，而且内部各点的相对位置不变的物体），刚体组件用于控制刚体物理行为。

### 物理元素的组成

在 Cocos Creator 中，一个节点所带有的物理元素可以由以下方式组成：

- 一个刚体组件
- 一个或多个碰撞器组件
- 一个刚体加一个或多个碰撞器组件

对于单个节点是很容易看出是否有物理元素的，但如果以节点链为单位，则很难看出物理元素是由哪些节点以及哪些组件组成的。

对于节点树的情况，目前有两个使用方案：

1. 每个节点只要有物理组件，就是一个元素，这样父子节点之间的组件没有依赖关系。若节点需要多个碰撞体形状，往该节点上添加相应的 **Collider** 组件即可。

    **缺点**：

    - 层级结构不够直观，多个形状只能往一个节点上加，而显示形状需要增加子节点模型，并且难以支持碰撞体的局部旋转。
    - 对节点链调整参数时，需要同时调整两个地方，分别为子节点的位置信息和父节点上对应 **Collider** 组件的数据信息。

2. 从自身节点开始往父链节点上搜索，如果找到了 **RigidBody** 组件，则将自身的 **Collider** 组件绑定到该节点上，否则整条链上的 **Collider** 组件将共享一个 **RigidBody** 组件，元素对应的节点是最顶层的 **Collider** 组件所对应的节点。

    **缺点**：

    - 增加了节点耦合，节点更新时，需要更新相应的依赖节点。
    - 在节点链被破坏时，需要维护内容更多，节点链在反复被破坏时需要处理复杂的逻辑。

> **注意**：目前 Cocos Creator 使用的是方案 **1**，后续版本也有进行调整的可能，请留意版本更新公告。

## 添加物理元素

在世界中添加一个物理元素可以分为以下步骤：

1. 新建一个形状 **Cube**；
2. 在右侧 **属性检查器** 面板下方点击 **添加组件** 按钮；
3. 在 **Physics** 目录下选择 **BoxCollider**，并调整参数；
4. 为了使它具有物理行为，接着添加一个 **RigidBody** 组件。

这样，便有了一个 **既有碰撞器又有物理行为** 的一个物理元素。

### 完善物理世界

接着，完善物理世界，可以为世界添加一个地面，仿照 1，2 ，3 步骤，可以再添加一个 **只有碰撞器** 的 **Plane**；

然后，再调整摄像机的角度（选中摄像机，执行 **Ctrl + Shift + F** 可以对齐到屏幕）；

最后，点击运行按钮，便可以看到物理元素在场景世界上的变化，最后的场景如下图所示：

![物理世界](img/physics.jpg)
